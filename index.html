<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiko Fee Mechanism Explorer</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.min.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>Taiko Fee Explorer</h1>
            </div>


            <!-- Parameter Controls -->
            <div class="parameters-section">
                <h3>Parameter Controls</h3>

                <!-- Mu Parameter -->
                <div class="parameter-group">
                    <label for="mu-slider" class="parameter-label">
                        Œº (L1 Weight): <span id="mu-value">0.0</span>
                        <span class="tooltip" data-tooltip="Controls how much L1 costs influence L2 fees. 100% consensus from revised optimization: Œº=0.0 is definitively optimal across all 320 solutions from 4 scenarios. L1 correlation bias eliminated - pure deficit-based correction is superior.">‚ÑπÔ∏è</span>
                    </label>
                    <input type="range" id="mu-slider" class="parameter-slider" min="0" max="1" step="0.05" value="0.0">
                    <div class="range-labels">
                        <span>0.0</span>
                        <span>1.0</span>
                    </div>
                </div>

                <!-- Nu Parameter -->
                <div class="parameter-group">
                    <label for="nu-slider" class="parameter-label">
                        ŒΩ (Deficit Weight): <span id="nu-value">0.27</span>
                        <span class="tooltip" data-tooltip="Controls strength of vault deficit correction. Revised framework optimal values: ŒΩ=0.27 (optimal consensus), 0.48 (conservative), 0.88 (crisis). Consensus value from 320 solutions across 4 scenarios.">‚ÑπÔ∏è</span>
                    </label>
                    <input type="range" id="nu-slider" class="parameter-slider" min="0" max="1" step="0.05" value="0.27">
                    <div class="range-labels">
                        <span>0.0</span>
                        <span>1.0</span>
                    </div>
                </div>

                <!-- H Parameter -->
                <div class="parameter-group">
                    <label for="H-slider" class="parameter-label">
                        H (Horizon): <span id="H-value">492</span> steps
                        <span class="tooltip" data-tooltip="Time horizon for deficit correction aligned with L1 batch cycles. Revised framework optimal values: H=492 (optimal consensus), 492 (conservative), 120 (crisis). All values are 6-step aligned for batch cycle resonance.">‚ÑπÔ∏è</span>
                    </label>
                    <input type="range" id="H-slider" class="parameter-slider" min="24" max="576" step="24" value="492">
                    <div class="range-labels">
                        <span>24</span>
                        <span>576</span>
                    </div>
                </div>

                <!-- Transactions Per Block -->
                <div class="parameter-group">
                    <label for="tx-per-block-slider" class="parameter-label">
                        Transactions Per L1 Batch: <span id="tx-per-block-value">100</span>
                        <span class="tooltip" data-tooltip="Number of transactions per L1 batch submission. Gas cost per tx = 200k gas √∑ txs per batch. Higher values = lower gas cost per tx. Matches Python implementation defaults.">‚ÑπÔ∏è</span>
                    </label>
                    <input type="range" id="tx-per-block-slider" class="parameter-slider" min="50" max="500" step="10" value="100">
                    <div class="range-labels">
                        <span>50</span>
                        <span>500</span>
                    </div>
                </div>

                <!-- Vault Initialization -->
                <div class="parameter-group">
                    <label for="vault-init" class="parameter-label">
                        Vault Init
                        <span class="tooltip" data-tooltip="Starting vault balance. Critical for meaningful analysis.">‚ÑπÔ∏è</span>
                    </label>
                    <select id="vault-init" class="parameter-select">
                        <option value="target">At Target</option>
                        <option value="underfunded-20">20% Underfunded</option>
                        <option value="underfunded-50">50% Underfunded</option>
                        <option value="overfunded-20">20% Overfunded</option>
                    </select>
                </div>

                <!-- Guaranteed Recovery Toggle -->
                <div class="parameter-group">
                    <label class="parameter-label">
                        Deficit Recovery Mode
                        <span class="tooltip" data-tooltip="Standard: Uses asymptotic correction (ŒΩ√óD/H). Guaranteed: Adds minimum rate to ensure complete recovery to target balance.">‚ÑπÔ∏è</span>
                    </label>
                    <div class="toggle-container">
                        <input type="checkbox" id="guaranteed-recovery" class="toggle-checkbox">
                        <label for="guaranteed-recovery" class="toggle-switch">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">Guaranteed Recovery</span>
                    </div>
                    <div class="parameter-description">
                        Prevents asymptotic stalling near target balance
                    </div>

                    <!-- Minimum Deficit Rate (visible only when guaranteed recovery is enabled) -->
                    <div id="min-deficit-rate-group" class="sub-parameter-group" style="display: none; margin-top: 10px;">
                        <label for="min-deficit-rate-slider" class="parameter-label">
                            Min Deficit Rate: <span id="min-deficit-rate-value">0.001</span> ETH/step
                            <span class="tooltip" data-tooltip="Minimum deficit correction rate per step when guaranteed recovery is active. Higher values = faster recovery.">‚ÑπÔ∏è</span>
                        </label>
                        <input type="range" id="min-deficit-rate-slider" class="parameter-slider" min="-6" max="-2" step="0.2" value="-3">
                        <div class="range-labels">
                            <span>1e-6</span>
                            <span>1e-2</span>
                        </div>
                    </div>
                </div>

                <!-- L1 Data Source Tabs -->
                <div class="parameter-group">
                    <label class="parameter-label">
                        L1 Base Fee Data Source
                        <span class="tooltip" data-tooltip="Choose between historical Ethereum data or simulated GBM model">‚ÑπÔ∏è</span>
                    </label>

                    <!-- Tab Navigation -->
                    <div class="tab-navigation">
                        <button class="tab-button active" data-tab="historical">Historical</button>
                        <button class="tab-button" data-tab="simulated">Simulated</button>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Historical Tab -->
                        <div class="tab-pane active" id="historical-tab">
                            <div class="historical-periods-list">
                                <label class="period-option">
                                    <input type="radio" name="historical-period" value="may2023" checked>
                                    <div class="period-content">
                                        <div class="period-title">May 2023 PEPE Crisis</div>
                                        <div class="period-description">Memecoin mania extreme fees (60-184 gwei)</div>
                                    </div>
                                </label>
                                <label class="period-option">
                                    <input type="radio" name="historical-period" value="may2022">
                                    <div class="period-content">
                                        <div class="period-title">May 2022 Luna Crash</div>
                                        <div class="period-description">Peak: 1,352 gwei on May 12 (8h window)</div>
                                    </div>
                                </label>
                                <label class="period-option">
                                    <input type="radio" name="historical-period" value="june2022">
                                    <div class="period-content">
                                        <div class="period-title">July 2022 Real Market Volatility</div>
                                        <div class="period-description">Actual Ethereum data (7-88 gwei)</div>
                                    </div>
                                </label>
                                <label class="period-option">
                                    <input type="radio" name="historical-period" value="recent">
                                    <div class="period-content">
                                        <div class="period-title">Recent Low Fees (3h)</div>
                                        <div class="period-description">Nov 2025 (0.055-0.092 gwei)</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Simulated Tab -->
                        <div class="tab-pane" id="simulated-tab">
                            <!-- Simulation Seed -->
                            <div class="sub-parameter-group">
                                <label for="seed-input" class="parameter-label">
                                    Simulation Seed
                                    <span class="tooltip" data-tooltip="Random seed for reproducible simulations">‚ÑπÔ∏è</span>
                                </label>
                                <input type="number" id="seed-input" class="parameter-input" value="42" min="0" max="999999">
                            </div>

                            <!-- L1 Volatility -->
                            <div class="sub-parameter-group">
                                <label for="volatility-slider" class="parameter-label">
                                    L1 Volatility: <span id="volatility-value">0.3</span>
                                    <span class="tooltip" data-tooltip="Simulated L1 market volatility. 0.3 = normal, 0.8 = crisis.">‚ÑπÔ∏è</span>
                                </label>
                                <input type="range" id="volatility-slider" class="parameter-slider" min="0.1" max="1.0" step="0.1" value="0.3">
                                <div class="range-labels">
                                    <span>0.1</span>
                                    <span>1.0</span>
                                </div>
                            </div>

                            <!-- Duration Control -->
                            <div class="sub-parameter-group">
                                <label for="duration-slider" class="parameter-label">
                                    Simulation Duration: <span id="duration-value">3.0</span> hours
                                    <span class="tooltip" data-tooltip="Length of simulation. 1h for quick tests, 6h for thorough analysis. Each step = 2 seconds (Taiko block time).">‚ÑπÔ∏è</span>
                                </label>
                                <input type="range" id="duration-slider" class="parameter-slider" min="1" max="6" step="0.5" value="3">
                                <div class="range-labels">
                                    <span>1h</span>
                                    <span>6h</span>
                                </div>
                            </div>

                            <!-- Spike Delay -->
                            <div class="sub-parameter-group">
                                <label for="spike-delay-slider" class="parameter-label">
                                    Spike Delay: <span id="spike-delay-value">50</span>%
                                    <span class="tooltip" data-tooltip="When the volatility spike starts as percentage of total simulation time. 50% = middle of simulation.">‚ÑπÔ∏è</span>
                                </label>
                                <input type="range" id="spike-delay-slider" class="parameter-slider" min="0" max="90" step="5" value="50">
                                <div class="range-labels">
                                    <span>0%</span>
                                    <span>90%</span>
                                </div>
                            </div>

                            <!-- Spike Height -->
                            <div class="sub-parameter-group">
                                <label for="spike-height-slider" class="parameter-label">
                                    Spike Height: <span id="spike-height-value">0.3</span>
                                    <span class="tooltip" data-tooltip="Intensity of the spike. 0.1 = mild, 0.3 = moderate, 0.5 = extreme.">‚ÑπÔ∏è</span>
                                </label>
                                <input type="range" id="spike-height-slider" class="parameter-slider" min="0.1" max="0.8" step="0.1" value="0.3">
                                <div class="range-labels">
                                    <span>0.1</span>
                                    <span>0.8</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Presets -->
            <div class="preset-section">
                <h3>üéØ Optimal Presets</h3>
                <p class="preset-description">Hover over each preset for objectives & constraints. Click (‚ìò) for detailed analysis.</p>
                <div class="preset-buttons">
                    <button class="preset-btn featured" data-preset="optimal" data-tooltip="üéØ OPTIMAL STRATEGY (Œº=0.0, ŒΩ=0.27, H=492): Multi-scenario consensus parameters from revised optimization | CONSTRAINT: Validated across 320 solutions from 4 scenarios, eliminates L1 correlation bias">
                        üéØ Optimal
                        <span class="preset-tooltip-trigger">‚ìò</span>
                    </button>
                    <button class="preset-btn" data-preset="balanced" data-tooltip="‚öñÔ∏è BALANCED STRATEGY (Œº=0.0, ŒΩ=0.27, H=492): Same as optimal - consensus parameters | CONSTRAINT: Robust across normal, spike, crash, and crisis conditions">
                        ‚öñÔ∏è Balanced
                        <span class="preset-tooltip-trigger">‚ìò</span>
                    </button>
                    <button class="preset-btn" data-preset="crisis-resilient" data-tooltip="‚õëÔ∏è CRISIS-RESILIENT STRATEGY (Œº=0.0, ŒΩ=0.88, H=120): Aggressive correction for extreme volatility | CONSTRAINT: Highest safety scores in crisis scenarios with rapid response">
                        ‚õëÔ∏è Crisis-Resilient
                        <span class="preset-tooltip-trigger">‚ìò</span>
                    </button>
                </div>

                <!-- Detailed Preset Tooltips -->
                <div id="preset-tooltip-modal" class="preset-tooltip-modal" style="display: none;">
                    <div class="preset-tooltip-content">
                        <div class="preset-tooltip-header">
                            <h4 id="preset-tooltip-title"></h4>
                            <button class="preset-tooltip-close">&times;</button>
                        </div>
                        <div class="preset-tooltip-body">
                            <div id="preset-tooltip-details"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Research Tab Navigation -->
            <div class="research-tab-navigation">
                <button class="research-tab-button active" data-tab="simulation">
                    <span class="tab-icon">‚ö°</span>
                    Simulation
                </button>
                <button class="research-tab-button" data-tab="optimization">
                    <span class="tab-icon">üéØ</span>
                    Optimization
                </button>
            </div>

            <!-- Tab Content: Simulation -->
            <div class="research-tab-content active" id="simulation-tab-content">
            <!-- Fee Formula Header -->
            <div class="formula-header">
                <div class="formula-content">
                    <h2>Taiko Fee Mechanism</h2>
                    <div class="formula-container-main">
                        $$F_E(t) = \max\left(\mu \times C_{L1}(t) + \nu \times \frac{D(t)}{H}, F_{\text{min}}\right)$$
                        <button id="formula-info-btn" class="formula-info-btn" title="Toggle formula parameters">‚ìò</button>
                    </div>
                    <!-- Compact Info Box -->
                    <div id="formula-info-box" class="formula-info-box" style="display: none;">
                        <div class="info-grid">
                            <div class="info-item">
                                <strong>Main Formula Variables:</strong><br>
                                $F_E(t)$: Estimated fee at time t | $\mu$: L1 weight (<span id="info-mu">0.4</span>) | $\nu$: Deficit weight (<span id="info-nu">0.3</span>)<br>
                                $C_{L1}(t)$: L1 cost per tx | $D(t)$: Vault deficit | $H$: Horizon (<span id="info-h">144</span> steps) | $F_{\min}$: Min fee (1e-8 ETH)
                            </div>
                            <div class="info-item">
                                <strong>L1 Cost Calculation:</strong><br>
                                $$C_{L1}(t) = \frac{\text{BaseFee}_{L1}(t) \times \text{Gas}_{\text{per tx}}}{10^{18}}$$
                                Where:<br>
                                ‚Ä¢ $\text{BaseFee}_{L1}(t)$ = Current L1 basefee at time $t$ (in wei)<br>
                                ‚Ä¢ $\text{Gas}_{\text{per tx}} = \max\left(\frac{200{,}000}{\text{Expected Tx Volume}}, 200\right)$ gas<br>
                                ‚Ä¢ Economies of scale: Higher expected volume ‚Üí Lower gas cost per transaction<br>
                                ‚Ä¢ Floor at 200 gas accounts for minimum batch overhead
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="charts-grid">
                    <div class="chart-container">
                        <canvas id="fee-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="vault-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="l1-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="correlation-chart"></canvas>
                    </div>
                </div>
                <!-- Loading Overlay -->
                <div id="loading-overlay" class="loading-overlay" style="display: none;">
                    <div class="spinner"></div>
                    <p>Running simulation...</p>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="metrics-section">
                <h3>Performance Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric-card" id="avg-fee-card">
                        <div class="metric-label">Average Taiko Estimated Fee per Gas</div>
                        <div class="metric-value" id="avg-fee-value">-</div>
                        <div class="metric-unit">gwei</div>
                        <div class="metric-status" id="avg-fee-status"></div>
                    </div>
                    <div class="metric-card" id="fee-cv-card">
                        <div class="metric-label">Taiko Estimated Fee Variability</div>
                        <div class="metric-value" id="fee-cv-value">-</div>
                        <div class="metric-unit">CV</div>
                        <div class="metric-status" id="fee-cv-status"></div>
                    </div>
                    <div class="metric-card" id="underfunded-card">
                        <div class="metric-label">Time Underfunded</div>
                        <div class="metric-value" id="underfunded-value">-</div>
                        <div class="metric-unit">%</div>
                        <div class="metric-status" id="underfunded-status"></div>
                    </div>
                    <div class="metric-card" id="tracking-card">
                        <div class="metric-label">L1 Tracking Error</div>
                        <div class="metric-value" id="tracking-value">-</div>
                        <div class="metric-unit">ratio</div>
                        <div class="metric-status" id="tracking-status"></div>
                    </div>
                </div>

                <!-- Metrics Explanation -->
                <div class="metrics-explanation">
                    <h4>Metric Interpretation</h4>
                    <div class="explanation-grid">
                        <div class="explanation-item">
                            <strong>Average Taiko Estimated Fee per Gas:</strong> Mean gas cost over simulation period. Lower values reduce user burden but must cover L1 operational costs. Comparable to L1 basefee.
                        </div>
                        <div class="explanation-item">
                            <strong>Taiko Estimated Fee Variability (CV):</strong> Coefficient of variation measuring fee stability.
                            <span class="threshold">Excellent: &lt;0.5, Good: 0.5-1.0, Poor: &gt;1.0</span>
                        </div>
                        <div class="explanation-item">
                            <strong>Time Underfunded:</strong> Percentage of simulation time with vault deficit > 0.01% of target balance.
                            <span class="threshold">Excellent: &lt;5%, Good: 5-15%, Poor: &gt;15%</span>
                        </div>
                        <div class="explanation-item">
                            <strong>L1 Tracking Error:</strong> Deviation between fees and actual L1 costs (normalized standard deviation).
                            <span class="threshold">Excellent: &lt;0.3, Good: 0.3-0.6, Poor: &gt;0.6</span>
                        </div>
                    </div>
                </div>

                <!-- L1 Cost Estimation Analysis Chart -->
                <div class="l1-estimation-section">
                    <h4>L1 Cost Estimation Analysis</h4>
                    <div class="chart-container-single">
                        <canvas id="l1-estimation-chart"></canvas>
                    </div>
                    <div class="estimation-explanation">
                        <p><strong>Trend vs Spot L1 Basefee:</strong> Shows how the smoothed trend basefee (used for L2 fee calculation) compares to actual spot L1 basefee. The trend approach reduces fee volatility while maintaining cost coverage. When Œº=0, this chart shows the underlying L1 dynamics without affecting L2 fees.</p>
                    </div>
                </div>

            </div>
        </div>
            <!-- End Simulation Tab Content -->

            <!-- Tab Content: Optimization Research -->
            <div class="research-tab-content" id="optimization-tab-content">
                <div class="optimization-research-interface">
                    <!-- Optimization Objectives Overview -->
                    <div class="objectives-overview">
                        <h3>üéØ Multi-Objective Optimization</h3>
                        <p>Configure weights for 11 metrics across three objective categories and discover Pareto optimal fee mechanism parameters.</p>

                        <!-- Objective Categories -->
                        <div class="objectives-grid">
                            <div class="objective-card ux-card">
                                <div class="objective-header">
                                    <span class="objective-icon">üë•</span>
                                    <h4>User Experience</h4>
                                </div>
                                <div class="objective-description">
                                    <p>Focuses on making fees affordable and predictable for users.</p>
                                    <div class="mathematical-formulation">
                                        $$\text{UX}(\mu, \nu, H) = \max \left[ w_1 \cdot \mathcal{A}(f) + w_2 \cdot \mathcal{S}(f) + w_3 \cdot \mathcal{P}_{\text{1h}}(f) + w_4 \cdot \mathcal{P}_{\text{6h}}(f) \right]$$
                                        <div class="formula-components">
                                            <small>where $\mathcal{A}(f) = -\log(1 + \bar{f} \times 1000)$, $\mathcal{S}(f) = 1 - \text{CV}(f)$, $\mathcal{P}_t(f)$ = predictability over window $t$</small>
                                        </div>
                                    </div>
                                    <div class="metrics-preview">
                                        <span class="metric-tag clickable-metric" data-metric="fee_affordability">üí∞ Fee Affordability</span>
                                        <span class="metric-tag clickable-metric" data-metric="fee_stability">üìà Fee Stability</span>
                                        <span class="metric-tag clickable-metric" data-metric="fee_predictability_1h">üîÆ Predictability</span>
                                    </div>
                                </div>
                            </div>

                            <div class="objective-card safety-card">
                                <div class="objective-header">
                                    <span class="objective-icon">üõ°Ô∏è</span>
                                    <h4>Protocol Safety</h4>
                                </div>
                                <div class="objective-description">
                                    <p>Ensures the protocol remains secure and well-funded under stress.</p>
                                    <div class="mathematical-formulation">
                                        $$\text{Safety}(\mu, \nu, H) = \max \left[ w_5 \cdot (1 - P_{\text{insol}}) + w_6 \cdot (1 - \mathcal{D}_{\text{weighted}}) + w_7 \cdot \mathcal{R}_{\text{stress}} \right]$$
                                        <div class="formula-components">
                                            <small>where $P_{\text{insol}} = \mathbb{P}(V < V_{\text{crit}})$, $\mathcal{D}_{\text{weighted}} = \frac{\sum (d_i \cdot t_i)^2}{T}$, $\mathcal{R}_{\text{stress}}$ = stress recovery rate</small>
                                        </div>
                                    </div>
                                    <div class="metrics-preview">
                                        <span class="metric-tag clickable-metric" data-metric="insolvency_protection">üö® Insolvency Protection</span>
                                        <span class="metric-tag clickable-metric" data-metric="deficit_duration">‚è∞ Deficit Control</span>
                                        <span class="metric-tag clickable-metric" data-metric="vault_stress">üí™ Resilience</span>
                                    </div>
                                </div>
                            </div>

                            <div class="objective-card efficiency-card">
                                <div class="objective-header">
                                    <span class="objective-icon">üí∞</span>
                                    <h4>Economic Efficiency</h4>
                                </div>
                                <div class="objective-description">
                                    <p>Optimizes capital usage and operational performance.</p>
                                    <div class="mathematical-formulation">
                                        $$\text{Efficiency}(\mu, \nu, H) = \max \left[ w_8 \cdot \mathcal{U}_{\text{vault}} + w_9 \cdot \mathcal{C}_{\text{correction}} + w_{10} \cdot \mathcal{E}_{\text{capital}} \right]$$
                                        <div class="formula-components">
                                            <small>where $\mathcal{U}_{\text{vault}} = 1 - \frac{\overline{|V - V_{\text{target}}|}}{V_{\text{target}}}$, $\mathcal{C}_{\text{correction}} = \frac{\Delta d}{\Delta t}$, $\mathcal{E}_{\text{capital}}$ = capital utilization efficiency</small>
                                        </div>
                                    </div>
                                    <div class="metrics-preview">
                                        <span class="metric-tag clickable-metric" data-metric="vault_utilization">üìä Vault Utilization</span>
                                        <span class="metric-tag clickable-metric" data-metric="deficit_correction">‚ö° Correction Speed</span>
                                        <span class="metric-tag clickable-metric" data-metric="capital_efficiency">üéØ Capital Efficiency</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Weight Configuration Section -->
                    <div class="weight-config-section">
                        <div class="section-header">
                            <h3>‚öñÔ∏è Weight Configuration</h3>
                            <p>Adjust the relative importance of different metrics. Weights within each category automatically normalize to 1.0.</p>
                            <div class="quick-presets">
                                <button class="preset-btn" data-preset="balanced">‚öñÔ∏è Balanced</button>
                                <button class="preset-btn" data-preset="ux-focused">üë• UX Focused</button>
                                <button class="preset-btn" data-preset="safety-focused">üõ°Ô∏è Safety Focused</button>
                                <button class="preset-btn" data-preset="efficiency-focused">üí∞ Efficiency Focused</button>
                            </div>
                        </div>

                        <!-- Weight Categories -->
                        <div class="weight-categories">
                            <!-- UX Weights -->
                            <div class="weight-category" data-category="ux">
                                <div class="category-header">
                                    <h4>üë• User Experience Weights</h4>
                                    <div class="category-status">
                                        <span class="sum-indicator">‚àë = <span id="ux-sum">1.000</span></span>
                                        <button class="reset-category" data-category="ux" title="Reset to defaults">üîÑ</button>
                                    </div>
                                </div>
                                <div class="weight-controls-grid">
                                    <div class="weight-control">
                                        <label class="weight-label">
                                            üí∞ Fee Affordability
                                            <span class="weight-value" id="w1-value">0.40</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w1-slider" min="0" max="1" step="0.05" value="0.40" class="weight-slider" data-weight="w1" data-category="ux">
                                            <button class="lock-weight" data-weight="w1" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Lower average transaction costs</div>
                                    </div>

                                    <div class="weight-control">
                                        <label class="weight-label">
                                            üìà Fee Stability
                                            <span class="weight-value" id="w2-value">0.30</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w2-slider" min="0" max="1" step="0.05" value="0.30" class="weight-slider" data-weight="w2" data-category="ux">
                                            <button class="lock-weight" data-weight="w2" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Consistent pricing without big swings</div>
                                    </div>

                                    <div class="weight-control">
                                        <label class="weight-label">
                                            üîÆ Predictability (1h)
                                            <span class="weight-value" id="w3-value">0.20</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w3-slider" min="0" max="1" step="0.05" value="0.20" class="weight-slider" data-weight="w3" data-category="ux">
                                            <button class="lock-weight" data-weight="w3" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Fees predictable over 1 hour</div>
                                    </div>

                                    <div class="weight-control">
                                        <label class="weight-label">
                                            ‚è±Ô∏è Predictability (6h)
                                            <span class="weight-value" id="w4-value">0.10</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w4-slider" min="0" max="1" step="0.05" value="0.10" class="weight-slider" data-weight="w4" data-category="ux">
                                            <button class="lock-weight" data-weight="w4" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Fees predictable over 6 hours</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Safety Weights -->
                            <div class="weight-category" data-category="safety">
                                <div class="category-header">
                                    <h4>üõ°Ô∏è Protocol Safety Weights</h4>
                                    <div class="category-status">
                                        <span class="sum-indicator">‚àë = <span id="safety-sum">1.000</span></span>
                                        <button class="reset-category" data-category="safety" title="Reset to defaults">üîÑ</button>
                                    </div>
                                </div>
                                <div class="weight-controls-grid">
                                    <div class="weight-control">
                                        <label class="weight-label">
                                            üö® Insolvency Protection
                                            <span class="weight-value" id="w5-value">0.40</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w5-slider" min="0" max="1" step="0.05" value="0.40" class="weight-slider" data-weight="w5" data-category="safety">
                                            <button class="lock-weight" data-weight="w5" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Prevents vault from running out of funds</div>
                                    </div>

                                    <div class="weight-control">
                                        <label class="weight-label">
                                            ‚è∞ Deficit Duration Control
                                            <span class="weight-value" id="w6-value">0.30</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w6-slider" min="0" max="1" step="0.05" value="0.30" class="weight-slider" data-weight="w6" data-category="safety">
                                            <button class="lock-weight" data-weight="w6" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Limits how long vault stays underfunded</div>
                                    </div>

                                    <div class="weight-control">
                                        <label class="weight-label">
                                            üí™ Vault Stress Resilience
                                            <span class="weight-value" id="w7-value">0.20</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w7-slider" min="0" max="1" step="0.05" value="0.20" class="weight-slider" data-weight="w7" data-category="safety">
                                            <button class="lock-weight" data-weight="w7" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Quick recovery during market volatility</div>
                                    </div>

                                    <div class="weight-control">
                                        <label class="weight-label">
                                            üîÑ Underfunding Resistance
                                            <span class="weight-value" id="w8-value">0.10</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w8-slider" min="0" max="1" step="0.05" value="0.10" class="weight-slider" data-weight="w8" data-category="safety">
                                            <button class="lock-weight" data-weight="w8" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Avoids extended periods below target</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Efficiency Weights -->
                            <div class="weight-category" data-category="efficiency">
                                <div class="category-header">
                                    <h4>üí∞ Economic Efficiency Weights</h4>
                                    <div class="category-status">
                                        <span class="sum-indicator">‚àë = <span id="efficiency-sum">1.000</span></span>
                                        <button class="reset-category" data-category="efficiency" title="Reset to defaults">üîÑ</button>
                                    </div>
                                </div>
                                <div class="weight-controls-grid">
                                    <div class="weight-control">
                                        <label class="weight-label">
                                            üìä Vault Utilization
                                            <span class="weight-value" id="w9-value">0.40</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w9-slider" min="0" max="1" step="0.05" value="0.40" class="weight-slider" data-weight="w9" data-category="efficiency">
                                            <button class="lock-weight" data-weight="w9" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Keeps vault balance near optimal level</div>
                                    </div>

                                    <div class="weight-control">
                                        <label class="weight-label">
                                            ‚ö° Deficit Correction Rate
                                            <span class="weight-value" id="w10-value">0.30</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w10-slider" min="0" max="1" step="0.05" value="0.30" class="weight-slider" data-weight="w10" data-category="efficiency">
                                            <button class="lock-weight" data-weight="w10" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Speed of recovering from deficits</div>
                                    </div>

                                    <div class="weight-control">
                                        <label class="weight-label">
                                            üéØ Capital Efficiency
                                            <span class="weight-value" id="w11-value">0.30</span>
                                        </label>
                                        <div class="weight-slider-container">
                                            <input type="range" id="w11-slider" min="0" max="1" step="0.05" value="0.30" class="weight-slider" data-weight="w11" data-category="efficiency">
                                            <button class="lock-weight" data-weight="w11" title="Lock weight">üîì</button>
                                        </div>
                                        <div class="weight-description">Maximum performance per unit of capital</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Algorithm Configuration -->
                    <div class="algorithm-config-section">
                        <div class="section-header">
                            <h3>üß¨ Algorithm Parameters</h3>
                            <p>Configure the NSGA-II genetic algorithm parameters for optimization.</p>
                        </div>
                        <div class="algorithm-controls">
                            <div class="algorithm-control">
                                <label class="algorithm-label">
                                    Population Size
                                    <span class="algorithm-value" id="population-value">100</span>
                                </label>
                                <input type="range" id="population-slider" min="50" max="200" step="10" value="100" class="algorithm-slider">
                                <div class="algorithm-description">Number of solutions per generation</div>
                            </div>
                            <div class="algorithm-control">
                                <label class="algorithm-label">
                                    Generations
                                    <span class="algorithm-value" id="generations-value">50</span>
                                </label>
                                <input type="range" id="generations-slider" min="20" max="100" step="5" value="50" class="algorithm-slider">
                                <div class="algorithm-description">Number of evolutionary iterations</div>
                            </div>
                            <div class="algorithm-control">
                                <label class="algorithm-label">
                                    Crossover Rate
                                    <span class="algorithm-value" id="crossover-value">0.9</span>
                                </label>
                                <input type="range" id="crossover-slider" min="0.5" max="1.0" step="0.05" value="0.9" class="algorithm-slider">
                                <div class="algorithm-description">Probability of combining solutions</div>
                            </div>
                            <div class="algorithm-control">
                                <label class="algorithm-label">
                                    Mutation Rate
                                    <span class="algorithm-value" id="mutation-value">0.1</span>
                                </label>
                                <input type="range" id="mutation-slider" min="0.05" max="0.3" step="0.01" value="0.1" class="algorithm-slider">
                                <div class="algorithm-description">Probability of random parameter changes</div>
                            </div>
                        </div>
                    </div>

                    <!-- 3D Visualization -->
                    <div class="visualization-section">
                        <div class="viz-header">
                            <h3>üìä Pareto Frontier 3D Plot</h3>
                            <div class="viz-controls">
                                <button id="reset-camera" class="btn-icon-small" title="Reset Camera">üéØ</button>
                                <button id="fullscreen-viz" class="btn-icon-small" title="Fullscreen">‚õ∂</button>
                            </div>
                        </div>
                        <div class="visualization-container">
                            <div id="pareto-visualization">
                                <!-- Three.js visualization will be initialized here -->
                            </div>
                        </div>
                    </div>

                    <!-- Optimization Controls -->
                    <div class="optimization-controls">
                        <button id="start-optimization" class="btn btn-primary">
                            <span class="btn-icon">üöÄ</span>
                            Start Optimization
                        </button>
                        <button id="stop-optimization" class="btn btn-secondary" disabled>
                            <span class="btn-icon">‚èπÔ∏è</span>
                            Stop
                        </button>
                        <button id="reset-optimization" class="btn btn-secondary">
                            <span class="btn-icon">üîÑ</span>
                            Reset
                        </button>
                        <button id="export-results" class="btn btn-secondary" disabled>
                            <span class="btn-icon">üíæ</span>
                            Export Results
                        </button>
                    </div>

                    <!-- Progress Section -->
                    <div class="progress-section">
                        <div class="progress-header">
                            <h3>üîÑ Optimization Progress</h3>
                            <span id="progress-status" class="status-badge">Ready to start</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-stats">
                            <span>Generation: <span id="current-generation">0</span>/<span id="total-generations">50</span></span>
                            <span>Solutions: <span id="solutions-count">0</span></span>
                            <span>Pareto Points: <span id="pareto-count">0</span></span>
                        </div>
                    </div>

                    <!-- Results and Analysis Section -->
                    <div class="results-section">
                        <div class="results-layout">
                            <!-- Solutions List -->
                            <div class="solutions-panel">
                                <div class="panel-header">
                                    <h3>üìä Optimization Solutions</h3>
                                    <div class="solutions-controls">
                                        <select id="sort-solutions" class="sort-select">
                                            <option value="dominance">Sort by Dominance Rank</option>
                                            <option value="ux">Sort by UX Score</option>
                                            <option value="safety">Sort by Safety Score</option>
                                            <option value="efficiency">Sort by Efficiency Score</option>
                                        </select>
                                        <button id="export-solutions" class="btn-small" disabled>üìã Export</button>
                                    </div>
                                </div>
                                <div id="solutions-list" class="solutions-list">
                                    <div class="empty-state">
                                        <div class="empty-icon">üéØ</div>
                                        <p>No solutions yet</p>
                                        <p class="empty-description">Start optimization to discover Pareto optimal fee mechanism parameters</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Selected Solution Details -->
                            <div class="solution-details-panel">
                                <div class="panel-header">
                                    <h3>üîç Solution Details</h3>
                                </div>
                                <div id="solution-details" class="solution-details">
                                    <div class="empty-state">
                                        <div class="empty-icon">üëÜ</div>
                                        <p>Select a solution</p>
                                        <p class="empty-description">Click on a solution in the list or 3D plot to view detailed metrics and parameters</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Convergence Analysis -->
                        <div class="convergence-section">
                            <div class="section-header">
                                <h3>üìà Convergence Analysis</h3>
                                <p>Monitor how the algorithm improves solutions over generations.</p>
                            </div>
                            <div class="convergence-charts">
                                <div class="convergence-chart">
                                    <canvas id="convergence-chart"></canvas>
                                </div>
                                <div class="convergence-metrics">
                                    <div class="convergence-metric">
                                        <div class="metric-label">Hypervolume</div>
                                        <div class="metric-value" id="hypervolume-value">-</div>
                                        <div class="metric-description">Quality of Pareto frontier</div>
                                    </div>
                                    <div class="convergence-metric">
                                        <div class="metric-label">Spread</div>
                                        <div class="metric-value" id="spread-value">-</div>
                                        <div class="metric-description">Diversity of solutions</div>
                                    </div>
                                    <div class="convergence-metric">
                                        <div class="metric-label">Convergence</div>
                                        <div class="metric-value" id="convergence-value">-</div>
                                        <div class="metric-description">Distance to true Pareto front</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Optimization Research Tab Content -->

        </div>
    </div>



    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="simulator.js"></script>
    <script src="charts.js"></script>
    <script src="pareto-visualizer.js"></script>
    <script src="nsga-ii-web.js"></script>
    <script src="optimization-research.js"></script>
    <script src="app.js"></script>
</body>
</html>